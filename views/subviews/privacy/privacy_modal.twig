{#
    LimeSurvey
    Copyright (C) 2007-2017 The LimeSurvey Project Team / Louis Gac
    All rights reserved.
    License: GNU/GPL License v2 or later, see LICENSE.php
    LimeSurvey is free software. This version may have been modified pursuant
    to the GNU General Public License, and as distributed it includes or
    is derivative of works licensed under the GNU General Public License or
    other free or open source software licenses.
    See COPYRIGHT.php for copyright notices and details.

    (¯`·._.·(¯`·._.· Privacy with DSFR accordion ·._.·´¯)·._.·´¯)

    Show the privacy message in a DSFR accordion

#}

{% set describeprivacy = "datasecurity_notice" %}

{# Alerte d'erreur si la politique n'est pas acceptée #}
{% if aSurveyInfo.datasecurity_error %}
<div class="{{ aSurveyInfo.class.activealert }} fr-alert fr-alert--error fr-my-4w {% if not aSurveyInfo.datasecuritynotaccepted %}ls-js-hidden {% endif %}" role="alert" {{ aSurveyInfo.attr.activealert }} id="datasecurity_error">
    <p class="fr-alert__title">{{ aSurveyInfo.datasecurity_error }}</p>
</div>
	{% if aSurveyInfo.datasecuritynotaccepted %}
		{% set describeprivacy = "datasecurity_error " ~ describeprivacy %}
	{% endif %}
{% endif %}

{# Checkbox de consentement avec lien vers la modale #}
<div class="fr-checkbox-group fr-mt-4w">
    <input aria-required="true" class="{{ aSurveyInfo.class.privacydataseccheckbox }} fr-checkbox-input" type="checkbox" name="datasecurity_accepted" id="datasecurity_accepted"{% if describeprivacy %} aria-describedby="{{describeprivacy}}" {% endif %} />
    <label for="datasecurity_accepted" class="fr-label {{ aSurveyInfo.class.privacydataseccheckboxlabel }}">
        <strong>{{ aSurveyInfo.datasecurity_notice_label }}</strong>
    </label>
</div>
<div class="fr-my-2w">
    <a href="#privacy-modal" class="fr-link" data-fr-opened="false" aria-controls="privacy-modal">
        Consulter la politique de confidentialité et de traitement des données
    </a>
</div>
<script>
$(function() {
    $("#ls-button-submit").on("click", function() {
        if(!$('#datasecurity_accepted').prop('checked')) {
            /* dynamic show error */
            $('#datasecurity_error').removeClass("ls-js-hidden");
            if($('#datasecurity_error').length) {
                /* add it in aria and role */
                $('#datasecurity_error').attr("role", "alert");
                $('#datasecurity_accepted').attr("aria-describedby", "datasecurity_error {{ datasecuritynotice }}");
            }
        }
    });
});
$("#datasecurity_accepted").on("change", function() {
    if($('#datasecurity_accepted').prop('checked')) {
        /* dynamic hide error */
        $('#datasecurity_error').addClass("ls-js-hidden");
    }
});
</script>
