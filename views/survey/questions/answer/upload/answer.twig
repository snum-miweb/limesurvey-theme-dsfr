{#
/**
 * File Upload Question - DSFR Theme
 * Type: | (File Upload)
 *
 * This template renders file upload field(s) with DSFR styling
 * Uses DSFR upload component
 *
 * @var $name               Question name
 * @var $max_num_of_files  Maximum number of files allowed
 * @var $max_filesize      Maximum file size in KB
 * @var $allowed_filetypes Comma-separated list of allowed extensions
 * @var $show_title        Show title for uploaded files
 * @var $show_comment      Show comment field for files
 * @var $uploadedfiles     Array of already uploaded files
 * @var $basename          Base name for aria labels
 */
#}

<!-- File Upload (Type |) - DSFR -->
<div class="fr-upload-group">
    {% if help %}
        <div class="fr-hint-text fr-mb-2w">{{ help }}</div>
    {% endif %}

    <!-- File restrictions info -->
    <div class="fr-callout fr-callout--grey-light fr-mb-3w">
        <p class="fr-callout__text">
            <strong>{{ gT('Upload restrictions:') }}</strong><br>
            {{ gT('Maximum files:') }} {{ max_num_of_files|default(1) }}<br>
            {{ gT('Maximum size per file:') }} {{ (max_filesize|default(5000) / 1000)|number_format(1) }} MB<br>
            {{ gT('Allowed file types:') }} {{ allowed_filetypes|default('pdf, jpg, png')|upper }}
        </p>
    </div>

    <!-- File input -->
    <div class="fr-input-group">
        <label class="fr-label" for="answer{{ name }}">
            {% if max_num_of_files > 1 %}
                {{ gT('Select file(s) to upload') }}
            {% else %}
                {{ gT('Select file to upload') }}
            {% endif %}
        </label>

        <input
            type="file"
            class="fr-upload"
            name="{{ name }}[]"
            id="answer{{ name }}"
            {% if max_num_of_files > 1 %}multiple="multiple"{% endif %}
            accept="{{ allowed_filetypes|split(',')|map(ext => '.' ~ ext|trim)|join(',') }}"
            aria-labelledby="ls-question-text-{{ basename }}"
            data-max-files="{{ max_num_of_files|default(1) }}"
            data-max-size="{{ max_filesize|default(5000) }}"
        />

        <p class="fr-hint-text fr-mt-1w">
            {% if max_num_of_files > 1 %}
                {{ gT('You can select multiple files (Ctrl+Click or Cmd+Click)') }}
            {% else %}
                {{ gT('Click to select a file from your computer') }}
            {% endif %}
        </p>
    </div>

    <!-- Uploaded files list (if any) -->
    {% if uploadedfiles is defined and uploadedfiles is not empty %}
        <div class="fr-mt-4w">
            <p class="fr-text--bold">{{ gT('Uploaded files:') }}</p>
            <ul class="uploaded-files-list">
                {% for file in uploadedfiles %}
                    <li class="fr-mb-2w">
                        <div class="fr-grid-row fr-grid-row--gutters">
                            <div class="fr-col-8">
                                <span class="fr-icon-attachment-line fr-mr-1w" aria-hidden="true"></span>
                                {{ file.name }} ({{ (file.size / 1024)|number_format(1) }} KB)
                            </div>
                            <div class="fr-col-4 fr-text--right">
                                <button
                                    type="button"
                                    class="fr-btn fr-btn--sm fr-btn--tertiary fr-icon-delete-line"
                                    onclick="removeFile('{{ file.name }}', '{{ name }}')"
                                    title="{{ gT('Delete file') }}"
                                >
                                    {{ gT('Delete') }}
                                </button>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>

<!-- end of File Upload -->
